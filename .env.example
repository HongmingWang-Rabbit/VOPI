# VOPI Backend Environment Variables
# Copy this file to .env and fill in your values

# =============================================================================
# Server Configuration
# =============================================================================
NODE_ENV=development
PORT=3000
HOST=0.0.0.0

# =============================================================================
# Database (PostgreSQL)
# =============================================================================
DATABASE_URL=postgres://postgres:postgres@localhost:5432/vopi
DB_POOL_MAX=20
DB_POOL_IDLE_TIMEOUT_MS=30000
DB_POOL_CONNECTION_TIMEOUT_MS=2000

# =============================================================================
# Redis (for BullMQ job queue)
# =============================================================================
REDIS_URL=redis://localhost:6379

# =============================================================================
# Authentication
# Comma-separated list of valid API keys
# =============================================================================
API_KEYS=test-api-key,another-key

# =============================================================================
# S3/Storage Configuration (S3-compatible storage)
# =============================================================================
# VOPI supports any S3-compatible storage provider.
# S3_ENDPOINT is REQUIRED - the server will not start without it.

S3_BUCKET=vopi-storage
S3_REGION=us-east-1

# --- Local MinIO development (docker-compose) ---
S3_ENDPOINT=http://localhost:9000
S3_ACCESS_KEY_ID=minioadmin
S3_SECRET_ACCESS_KEY=minioadmin
S3_FORCE_PATH_STYLE=true

# --- AWS S3 ---
# S3_ENDPOINT=https://s3.us-east-1.amazonaws.com
# S3_ACCESS_KEY_ID=your-aws-access-key
# S3_SECRET_ACCESS_KEY=your-aws-secret-key
# S3_FORCE_PATH_STYLE=false

# --- DigitalOcean Spaces ---
# S3_ENDPOINT=https://nyc3.digitaloceanspaces.com
# S3_ACCESS_KEY_ID=your-do-access-key
# S3_SECRET_ACCESS_KEY=your-do-secret-key
# S3_FORCE_PATH_STYLE=false

# --- Cloudflare R2 ---
# S3_ENDPOINT=https://<account-id>.r2.cloudflarestorage.com
# S3_ACCESS_KEY_ID=your-r2-access-key
# S3_SECRET_ACCESS_KEY=your-r2-secret-key
# S3_FORCE_PATH_STYLE=true

# =============================================================================
# External APIs
# =============================================================================

# Google AI API Key (required for Gemini classification)
# Get your key at: https://aistudio.google.com/app/apikey
GOOGLE_AI_API_KEY=your_api_key_here
GEMINI_MODEL=gemini-2.0-flash

# Photoroom API Key (required for background removal)
# Get your key at: https://www.photoroom.com/api
PHOTOROOM_API_KEY=your_photoroom_key_here
PHOTOROOM_BASIC_HOST=sdk.photoroom.com
PHOTOROOM_PLUS_HOST=image-api.photoroom.com

# Claid.ai API Key (optional, alternative background removal provider)
# Get your key at: https://claid.ai
CLAID_API_KEY=your_claid_key_here

# Stability AI API Key (optional, for inpainting holes in products)
# Get your key at: https://platform.stability.ai/account/keys
STABILITY_API_KEY=your_stability_key_here
# STABILITY_API_BASE=https://api.stability.ai

# =============================================================================
# Worker Configuration
# =============================================================================
WORKER_CONCURRENCY=2
JOB_TIMEOUT_MS=600000
TEMP_DIR_NAME=vopi
CALLBACK_TIMEOUT_MS=30000
CALLBACK_MAX_RETRIES=3
API_RETRY_DELAY_MS=2000
API_RATE_LIMIT_DELAY_MS=500

# =============================================================================
# Queue Configuration
# =============================================================================
QUEUE_JOB_ATTEMPTS=3
QUEUE_BACKOFF_DELAY_MS=5000
QUEUE_COMPLETED_AGE_SECONDS=86400
QUEUE_FAILED_AGE_SECONDS=604800

# =============================================================================
# Logging
# =============================================================================
LOG_LEVEL=info

# =============================================================================
# CORS Configuration
# =============================================================================
# Comma-separated list of allowed CORS domain patterns (regex supported)
# Example: 24rabbit\.com,example\.com
CORS_ALLOWED_DOMAINS=24rabbit\.com

# =============================================================================
# Auth Configuration
# =============================================================================
# Comma-separated list of paths to skip authentication
AUTH_SKIP_PATHS=/health,/ready,/docs

# =============================================================================
# Callback Configuration
# =============================================================================
# Comma-separated list of allowed callback URL domains (for SSRF protection)
# Leave empty to allow all domains (not recommended for production)
CALLBACK_ALLOWED_DOMAINS=

# =============================================================================
# FFmpeg Configuration
# =============================================================================
FFMPEG_PATH=ffmpeg
FFPROBE_PATH=ffprobe

# =============================================================================
# Presigned URL Configuration
# =============================================================================
# Expiry time for user upload presigned URLs (default: 3600 = 1 hour)
# PRESIGN_EXPIRATION_SECONDS=3600

# Expiry time for API presigned URLs (Photoroom, Claid, etc.) (default: 300 = 5 min)
# API_PRESIGN_EXPIRY_SECONDS=300
