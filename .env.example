# VOPI Backend Environment Variables
# Copy this file to .env and fill in your values

# =============================================================================
# Server Configuration
# =============================================================================
NODE_ENV=development
PORT=3000
HOST=0.0.0.0

# =============================================================================
# Database (PostgreSQL)
# =============================================================================
DATABASE_URL=postgres://postgres:postgres@localhost:5432/vopi
DB_POOL_MAX=20
DB_POOL_IDLE_TIMEOUT_MS=30000
DB_POOL_CONNECTION_TIMEOUT_MS=2000

# =============================================================================
# Redis (for BullMQ job queue)
# =============================================================================
REDIS_URL=redis://localhost:6379

# =============================================================================
# Authentication
# Comma-separated list of valid API keys
# =============================================================================
API_KEYS=test-api-key,another-key

# =============================================================================
# S3/Storage Configuration (S3-compatible storage)
# =============================================================================
# VOPI supports any S3-compatible storage provider.
# S3_ENDPOINT is REQUIRED - the server will not start without it.

S3_BUCKET=vopi-storage
S3_REGION=us-east-1

# --- Local MinIO development (docker-compose) ---
S3_ENDPOINT=http://localhost:9000
S3_ACCESS_KEY_ID=minioadmin
S3_SECRET_ACCESS_KEY=minioadmin
S3_FORCE_PATH_STYLE=true

# --- AWS S3 ---
# S3_ENDPOINT=https://s3.us-east-1.amazonaws.com
# S3_ACCESS_KEY_ID=your-aws-access-key
# S3_SECRET_ACCESS_KEY=your-aws-secret-key
# S3_FORCE_PATH_STYLE=false

# --- DigitalOcean Spaces ---
# S3_ENDPOINT=https://nyc3.digitaloceanspaces.com
# S3_ACCESS_KEY_ID=your-do-access-key
# S3_SECRET_ACCESS_KEY=your-do-secret-key
# S3_FORCE_PATH_STYLE=false

# --- Cloudflare R2 ---
# S3_ENDPOINT=https://<account-id>.r2.cloudflarestorage.com
# S3_ACCESS_KEY_ID=your-r2-access-key
# S3_SECRET_ACCESS_KEY=your-r2-secret-key
# S3_FORCE_PATH_STYLE=true

# =============================================================================
# External APIs
# =============================================================================

# Google AI API Key (required for Gemini classification)
# Get your key at: https://aistudio.google.com/app/apikey
GOOGLE_AI_API_KEY=your_api_key_here
GEMINI_MODEL=gemini-2.0-flash

# Photoroom API Key (required for background removal)
# Get your key at: https://www.photoroom.com/api
PHOTOROOM_API_KEY=your_photoroom_key_here
PHOTOROOM_BASIC_HOST=sdk.photoroom.com
PHOTOROOM_PLUS_HOST=image-api.photoroom.com

# Claid.ai API Key (optional, alternative background removal provider)
# Get your key at: https://claid.ai
CLAID_API_KEY=your_claid_key_here

# Stability AI API Key (optional, for inpainting holes in products)
# Get your key at: https://platform.stability.ai/account/keys
STABILITY_API_KEY=your_stability_key_here
# STABILITY_API_BASE=https://api.stability.ai

# =============================================================================
# Worker Configuration
# =============================================================================
WORKER_CONCURRENCY=2
JOB_TIMEOUT_MS=600000
TEMP_DIR_NAME=vopi
CALLBACK_TIMEOUT_MS=30000
CALLBACK_MAX_RETRIES=3
API_RETRY_DELAY_MS=2000
API_RATE_LIMIT_DELAY_MS=500

# =============================================================================
# Queue Configuration
# =============================================================================
QUEUE_JOB_ATTEMPTS=3
QUEUE_BACKOFF_DELAY_MS=5000
QUEUE_COMPLETED_AGE_SECONDS=86400
QUEUE_FAILED_AGE_SECONDS=604800

# =============================================================================
# Logging
# =============================================================================
LOG_LEVEL=info

# =============================================================================
# CORS Configuration
# =============================================================================
# Comma-separated list of allowed CORS domain patterns (regex supported)
# Example: 24rabbit\.com,example\.com
CORS_ALLOWED_DOMAINS=24rabbit\.com

# =============================================================================
# Auth Configuration
# =============================================================================
# Comma-separated list of paths to skip authentication
AUTH_SKIP_PATHS=/health,/ready,/docs

# =============================================================================
# Callback Configuration
# =============================================================================
# Comma-separated list of allowed callback URL domains (for SSRF protection)
# Leave empty to allow all domains (not recommended for production)
CALLBACK_ALLOWED_DOMAINS=

# =============================================================================
# FFmpeg Configuration
# =============================================================================
FFMPEG_PATH=ffmpeg
FFPROBE_PATH=ffprobe

# =============================================================================
# Presigned URL Configuration
# =============================================================================
# Expiry time for user upload presigned URLs (default: 3600 = 1 hour)
# PRESIGN_EXPIRATION_SECONDS=3600

# Expiry time for API presigned URLs (Photoroom, Claid, etc.) (default: 300 = 5 min)
# API_PRESIGN_EXPIRY_SECONDS=300

# =============================================================================
# JWT Configuration (for user authentication)
# =============================================================================
# Secret for signing JWT tokens (minimum 32 characters)
# JWT_SECRET=your-32-character-minimum-secret-here

# Token expiration times
# JWT_ACCESS_TOKEN_EXPIRES_IN=15m
# JWT_REFRESH_TOKEN_EXPIRES_IN=7d

# =============================================================================
# OAuth: Google
# =============================================================================
# Get credentials at: https://console.cloud.google.com/apis/credentials
#
# You need THREE OAuth clients:
# 1. Web application - for backend server (has client secret)
# 2. iOS app - for iOS mobile (no client secret, uses bundle ID)
# 3. Android app - for Android mobile (no client secret, uses package + SHA-1)
#
# Web Client (required - used by backend)
# GOOGLE_CLIENT_ID=123456789-abc.apps.googleusercontent.com
# GOOGLE_CLIENT_SECRET=GOCSPX-xxx
# GOOGLE_REDIRECT_URI=https://api.vopi.24rabbit.com/api/v1/auth/google/callback
#
# iOS Client (for mobile app verification)
# GOOGLE_IOS_CLIENT_ID=123456789-ios.apps.googleusercontent.com
# GOOGLE_IOS_BUNDLE_ID=com.24rabbit.vopi
#
# Android Client (for mobile app verification)
# GOOGLE_ANDROID_CLIENT_ID=123456789-android.apps.googleusercontent.com
# GOOGLE_ANDROID_PACKAGE_NAME=com.24rabbit.vopi

# =============================================================================
# OAuth: Apple
# =============================================================================
# Get credentials at: https://developer.apple.com/account/resources/identifiers
# APPLE_CLIENT_ID=your-apple-service-id
# APPLE_TEAM_ID=your-apple-team-id
# APPLE_KEY_ID=your-apple-key-id
# APPLE_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----

# =============================================================================
# Token Encryption
# =============================================================================
# Key for encrypting OAuth tokens at rest (minimum 32 characters)
# TOKEN_ENCRYPTION_KEY=your-32-character-minimum-secret-here

# =============================================================================
# E-Commerce: Shopify
# =============================================================================
# Get credentials at: https://partners.shopify.com
# SHOPIFY_API_KEY=your-shopify-api-key
# SHOPIFY_API_SECRET=your-shopify-api-secret
# SHOPIFY_SCOPES=write_products,read_products

# =============================================================================
# E-Commerce: Amazon SP-API
# =============================================================================
# Get credentials at: https://sellercentral.amazon.com/apps/manage
# AMAZON_CLIENT_ID=your-amazon-client-id
# AMAZON_CLIENT_SECRET=your-amazon-client-secret

# =============================================================================
# E-Commerce: eBay
# =============================================================================
# Get credentials at: https://developer.ebay.com/my/keys
# EBAY_CLIENT_ID=your-ebay-client-id
# EBAY_CLIENT_SECRET=your-ebay-client-secret
# EBAY_REDIRECT_URI=https://your-app.com/api/v1/oauth/ebay/callback
# EBAY_ENVIRONMENT=production

# =============================================================================
# Token Refresh Worker
# =============================================================================
# How often to check for expiring platform tokens (default: 5 minutes)
# TOKEN_REFRESH_INTERVAL_MS=300000

# Refresh tokens that expire within this threshold (default: 15 minutes)
# TOKEN_REFRESH_THRESHOLD_MS=900000

# =============================================================================
# Stripe (Credit Purchases)
# =============================================================================
# Get credentials at: https://dashboard.stripe.com/apikeys
# STRIPE_SECRET_KEY=sk_test_...
# STRIPE_WEBHOOK_SECRET=whsec_...

# Create price IDs in Stripe Dashboard: https://dashboard.stripe.com/products
# STRIPE_PRICE_ID_CREDIT_1=price_...   # Single Credit - $0.99
# STRIPE_PRICE_ID_PACK_20=price_...    # 20 Credit Pack - $14.99
# STRIPE_PRICE_ID_PACK_100=price_...   # 100 Credit Pack - $59
# STRIPE_PRICE_ID_PACK_500=price_...   # 500 Credit Pack - $199

# =============================================================================
# Abuse Prevention
# =============================================================================
# Max signup grants per IP address (default: 3)
# SIGNUP_GRANT_IP_LIMIT=3

# Max signup grants per device fingerprint (default: 2)
# SIGNUP_GRANT_DEVICE_LIMIT=2
